<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Aqua AI </title>
<style>
  /* Aqua glass-themed dark style, expanded and enhanced */
  :root {
    --color-primary: #00d4ff;
    --color-primary-dark: #0088a8;
    --color-bg-dark: #0a1b2a;
    --color-bg-secondary: rgba(10, 27, 42, 0.7);
    --color-text-primary: #e8ecf1;
    --color-text-secondary: #a8b2c1;
    --color-border: rgba(0, 212, 255, 0.3);
  }

  * {
    box-sizing: border-box;
  }

  body {
    margin: 0; padding: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: var(--color-bg-dark);
    color: var(--color-text-primary);
    -webkit-font-smoothing: antialiased;
    display: flex;
    flex-direction: column;
    height: 100vh;
  }

  header {
    text-align: center;
    padding: 20px;
    font-weight: 700;
    font-size: 2rem;
    user-select: none;
    background: var(--color-bg-secondary);
    backdrop-filter: blur(15px);
    border-bottom: 1px solid var(--color-border);
    color: var(--color-primary);
  }

  main {
    flex: 1;
    margin: 20px auto;
    max-width: 700px;
    background: var(--color-bg-secondary);
    border-radius: 15px;
    box-shadow: 0 0 30px var(--color-border);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    backdrop-filter: blur(15px);
  }

  #chat {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 15px;
  }

  .message {
    max-width: 70%;
    padding: 12px 20px;
    border-radius: 20px;
    font-size: 1rem;
    word-break: break-word;
    line-height: 1.4;
  }

  .message.user {
    background: linear-gradient(135deg, rgba(48, 131, 220, 0.9), rgba(0, 136, 168, 0.8));
    color: white;
    align-self: flex-end;
  }

  .message.ai {
    background: rgba(0, 212, 255, 0.7);
    color: var(--color-bg-dark);
    border: 1px solid rgba(0, 212, 255, 0.6);
    align-self: flex-start;
  }

  #input-area {
    border-top: 1px solid var(--color-border);
    display: flex;
    gap: 10px;
    padding: 15px 20px;
    background: var(--color-bg-secondary);
  }

  #text-input {
    flex-grow: 1;
    padding: 12px 20px;
    border-radius: 25px;
    border: none;
    outline: none;
    font-size: 1rem;
    background: rgba(255, 255, 255, 0.1);
    color: var(--color-text-primary);
    transition: box-shadow 0.3s ease;
  }
  #text-input::placeholder {
    color: var(--color-text-secondary);
  }
  #text-input:focus {
    box-shadow: 0 0 10px var(--color-primary);
    background: rgba(255, 255, 255, 0.15);
  }

  button {
    border: none;
    border-radius: 25px;
    padding: 0 25px;
    font-weight: 700;
    cursor: pointer;
    background: var(--color-primary);
    color: var(--color-bg-dark);
    transition: background 0.3s ease;
  }
  button:hover:not(:disabled) {
    background: var(--color-primary-dark);
  }
  button:disabled {
    background: #555;
    cursor: not-allowed;
  }
</style>
</head>
<body>
<header>AquaAI</header>

<main>
  <div id="chat"></div>
  <div id="input-area">
    <input id="text-input" type="text" placeholder="Type your message here..." autocomplete="off" />
    <button id="send-btn">Send</button>
    <button id="voice-btn" title="Voice input">ðŸŽ¤ Voice</button>
  </div>
</main>

<script>
  const chat = document.getElementById("chat");
  const textInput = document.getElementById("text-input");
  const sendBtn = document.getElementById("send-btn");
  const voiceBtn = document.getElementById("voice-btn");

  function appendMessage(text, sender) {
    const div = document.createElement("div");
    div.classList.add("message");
    div.classList.add(sender === "user" ? "user" : "ai");
    div.textContent = text;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
  }

  async function sendMessage() {
    const message = textInput.value.trim();
    if (!message) return;
    appendMessage(message, "user");
    textInput.value = "";
    try {
      const res = await fetch("/ask", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ prompt: message })
      });
      const data = await res.json();
      appendMessage(data.answer, "ai");
      speakText(data.answer);
    } catch {
      appendMessage("Error: Could not reach server.", "ai");
    }
  }

  sendBtn.addEventListener("click", sendMessage);
  textInput.addEventListener("keypress", e => {
    if (e.key === "Enter") {
      e.preventDefault();
      sendMessage();
    }
  });

  // Voice recognition and synthesis
  let recognition = null;
  let recognizing = false;

  if ("webkitSpeechRecognition" in window) {
    recognition = new webkitSpeechRecognition();
    recognition.lang = "en-US";
    recognition.interimResults = false;
    recognition.continuous = false;

    recognition.onstart = () => {
      recognizing = true;
      voiceBtn.textContent = "ðŸŽ¤ Listening...";
      voiceBtn.disabled = true;
    };

    recognition.onresult = async (event) => {
      recognizing = false;
      voiceBtn.textContent = "ðŸŽ¤ Voice";
      voiceBtn.disabled = false;
      const transcript = event.results[0][0].transcript;
      appendMessage(transcript, "user");
      try {
        const res = await fetch("/ask", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ prompt: transcript })
        });
        const data = await res.json();
        appendMessage(data.answer, "ai");
        speakText(data.answer);
      } catch {
        appendMessage("Error: Could not reach server.", "ai");
      }
    };

    recognition.onerror = () => {
      recognizing = false;
      voiceBtn.textContent = "ðŸŽ¤ Voice";
      voiceBtn.disabled = false;
      appendMessage("Voice recognition error occurred.", "ai");
    };

    recognition.onend = () => {
      recognizing = false;
      voiceBtn.textContent = "ðŸŽ¤ Voice";
      voiceBtn.disabled = false;
    };
  } else {
    voiceBtn.disabled = true;
    appendMessage("Voice recognition not supported on this browser.", "ai");
  }

  voiceBtn.addEventListener("click", () => {
    if (recognizing) {
      recognition.stop();
      recognizing = false;
    } else {
      recognition.start();
    }
  });

  function speakText(text) {
    if (!("speechSynthesis" in window)) return;
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.rate = 1;
    window.speechSynthesis.speak(utterance);
  }

  // Initial greeting
  appendMessage("Hello! I am Aqua AI. How can I assist you today?", "ai");
  // Voice recognition setup - add once on page load
if ("webkitSpeechRecognition" in window) {
  const recognition = new webkitSpeechRecognition();
  recognition.lang = "en-US";
  recognition.interimResults = false;
  recognition.continuous = false;

  recognition.onstart = () => {
    // Update UI to indicate listening state
  };
  recognition.onresult = async (event) => {
    const transcript = event.results[0][0].transcript;
    addUserMessage(transcript); // your existing function to add user msg
    try {
      const res = await fetch("/ask", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ prompt: transcript })
      });
      const data = await res.json();
      addAiMessage(data.answer);
      speakText(data.answer);
    } catch {
      addAiMessage("Error: Unable to reach server.");
    }
  };
  recognition.onerror = () => {
    // Handle error, update UI
  };
  recognition.onend = () => {
    // Cleanup UI listening state
  };

  // Hook up your voice button to start recognition:
  document.getElementById("yourVoiceBtnId").addEventListener("click", () => {
    recognition.start();
  });
} else {
  // Disable voice button and notify not supported
}

// Text to speech helper function
function speakText(text) {
  if (!("speechSynthesis" in window)) return;
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.rate = 1;
  window.speechSynthesis.speak(utterance);
}

</script>
</body>
</html>
